<!DOCTYPE xmlns:th="http://www.thymeleaf.org">
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>testjpa2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .main-container{
            display: flex;
            align-items: center;
        }
        .writeView{
            display: flex;
            flex-direction: column;
            text-align: center;
            align-items: center;
        }
        table#toplist td, table#newnotice td {
            text-align: center;
        }
        .listview{
            border: 1px solid black;
            min-width : 500px;
        }
        .listview td{
            border: 1px solid black;
        }
        .container{
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
        }
        .detail{
            display: flex;
            flex-direction: column;
        }
        .detailinput{
            margin: 10px;
            min-width : 500px;
            font-size: 20pt;
            font-family: sans-serif;
        }
    </style>
    <script type="text/javascript" src="/js/jquery-3.7.1.min.js"></script>
    <script type="text/javascript">
        pageCount = 0;
        $(function () {
            $.ajax({
                url: "/boards/btop3",
                type: "GET",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (json) {
                    /*console.log("success : " + data);
                    var str = JSON.stringify(data);
                    var json = JSON.parse(str);*/
                    values = "";
                    for (var i in json) {
                        values += "<tr><td>" + json[i].boardNum + "</td><td><a href='#' onclick='showDetail("+json[i].boardNum+")'> "
                            + json[i].boardTitle+"</a></td><td> "
                            + json[i].boardReadcount +
                            "</td></tr>";
                    };

                    $('#toplist').html($('#toplist').html() + values);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                }
            });  //ajax


            // $.ajax({
            //     url: "/boards/listCount",
            //     type: "GET",
            //     success: function (data) {
            //         pageCount = data;
            //         console.log(pageCount);
            //         finalPage = Math.ceil(pageCount/10);
            //          console.log('finalPage'+finalPage);
            //          var i;
            //          var addH='';
            //          for(i=1; i<finalPage+1;i++){
            //              addH += "<a href='#' class='pageNum' id="+i+">"+i+"</a>";
            //         };
            //          $('#num').html(addH);
            //     },
            //     error: function (jqXHR, textStatus, errorThrown) {
            //         console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
            //     }
            // }); //ajax


            //페이지 관련 버튼 클릭시 해당 페이지 요청 처리 ************************************
            currentPage =1;


            // 게시글 조회 출력 처리
            $.ajax({
                url: "/boards/list",
                type: "GET",
                data: {page: currentPage, limit: 10},
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var str = JSON.stringify(data);
                    var json = JSON.parse(str);

                    values = "";
                    for (var i in json) {
                        boardTitle = (json[i].boardOriginalFilename!= null && json[i].boardOriginalFilename.length>0)?json[i].boardTitle+"<img src='images/clip.png' width='15' height='15'>":json[i].boardTitle;
                        values += "<tr><td>" + json[i].boardNum + "</td><td><a href='#' onclick='showDetail("+json[i].boardNum+")'> "
                            + boardTitle+"</a></td><td> "+json[i].boardWriter+"</td><td><td>"+json[i].boardDate+"</td><td>"
                            + json[i].boardReadcount +
                            "</td></tr>";
                    };

                    $('#pagelist').html($('#pagelist').html() + values);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                }
            });  //ajax

        }); // document.ready

        function showDetail(boardNum){
             $.ajax({
                url: "/boards/"+boardNum,
                type: "GET",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (json) {
                    $('#boardTitle').val(json.boardTitle);
                    $('#boardWriter').val(json.boardWriter);
                    $('#boardContent').val(json.boardContent);
                    $('#boardNum').val(boardNum);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                }
            });  //ajax
        }
        function registerNewBoard(){
            boardTitle = $('#writeBoardTitle').val();
            boardWriter = $('#writeBoardWriter').val();
            boardContent = $('#writeBoardContent').val();
            var boardObject ={
                    boardTitle: boardTitle,
                    boardWriter: boardWriter,
                    boardContent: boardContent
                };
            $.ajax({
                url: "/boards",
                type: "POST",
                data: JSON.stringify(boardObject),
                contentType: "application/json; charset=utf-8",
                success: function () {
                    console.log('success!');
                    window.location.reload();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                }
            });  //ajax
        }
        function updateBoard(){
            boardNum = $('#boardNum').val();
            boardTitle = $('#boardTitle').val();
            boardWriter = $('#boardWriter').val();
            boardContent = $('#boardContent').val();
            var boardObject ={
                    boardNum: boardNum,
                    boardTitle: boardTitle,
                    boardWriter: boardWriter,
                    boardContent: boardContent
                };
            $.ajax({
                url: "/boards",
                type: "PUT",
                data: JSON.stringify(boardObject),
                contentType: "application/json; charset=utf-8",
                success: function () {
                    console.log('success!');
                    window.location.reload();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                }
            });  //ajax
        }
        function deleteBoard(){
            boardNum = $('#boardNum').val();
            $.ajax({
                url: "/boards/"+boardNum,
                type: "DELETE",
                success: function () {
                    console.log('success!');
                    window.location.reload();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                }
            });  //ajax
        }
    </script>
</head>
<body>
<h1>board service page : jpa 두 번째 방법</h1>
<hr>
<div class="main-container">
    <div id="listarea" align="center" style="margin-left:100px;">
        <div id="searcharea" style="margin-bottom: 20px;">
            <select id="category">
                <option value="title">제목</option>
                <option value="writer">작성자</option>
                <option value="date">날짜</option>
            </select>  &nbsp; &nbsp;
            <input type="search" id="search">&nbsp; <button onclick="fn_search();">검색</button>
        </div>
        <script type="text/javascript">
            function fn_search(){
                var category = $('#category').val();
                var keyword = $('#search').val();
                var url = "";
                var dataObj={};
                if(category =='title'){
                    url="/boards/title";
                    dataObj.keyword = keyword;
                    dataObj.page =1;
                    dataObj.limit = 10;
                }
                if(category == 'writer'){
                    url="/boards/writer";
                    dataObj.keyword = keyword;
                    dataObj.page =1;
                    dataObj.limit = 10;
                }
                if(category =='date'){
                    url="/boards/date";
                    dataObj.begin = keyword;
                    dataObj.end = keyword;
                    dataObj.page =1;
                    dataObj.limit = 10;
                }
                $.ajax({
                    url : url,
                    type:'GET',
                    data: dataObj,
                    dataType: 'json',
                    contentType: 'application/json;charset=UTF-8',
                    success: function(data){
                        var str = JSON.stringify(data);
                        var json = JSON.parse(str);

                        values = "";
                        for (var i in json) {
                            boardTitle = (json[i].boardOriginalFilename!= null && json[i].boardOriginalFilename.length>0)?json[i].boardTitle+"<img src='images/clip.png' width='15' height='15'>":json[i].boardTitle;
                            values += "<tr><td>" + json[i].boardNum + "</td><td><a href='#' onclick='showDetail("+json[i].boardNum+")'> "
                                    + boardTitle+"</a></td><td> "+json[i].boardWriter+"</td><td><td>"+json[i].boardDate+"</td><td>"
                                    + json[i].boardReadcount +
                                    "</td></tr>";
                            };

                    $('#pagelist').html("<tr><th>번호</th><th>제목</th><th>작성자</th><th>등록일</th><th>조회수</th></tr>" + values);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                    }

                })//ajax
            }
        </script>
        <table id="pagelist" width="550" align="center" border="1" cellspacing="0">
            <tr><th>번호</th><th>제목</th><th>작성자</th><th>등록일</th><th>조회수</th></tr>
        </table>
        <hr>
        <div id="pagearea">
            <button id="first" class="page">처음</button>
            <button id="prev" class="page">이전그룹</button>
            <span id="num"></span>
            <button id="next" class="page">다음그룹</button>
            <button id="2" class="page">마지막</button>
        </div>
    </div>
<div class="container">
<div>
    <h4>인기 게시글</h4>
    <table id="toplist" class="listview">
        <tr>
            <th>번호</th>
            <th>제목</th>
            <th>조회수</th>
        </tr>
    </table>
</div>
<div class="detail">
    <input type="text" id="boardTitle" class="detailinput" style="font-weight: bolder">
    <input type="text" id="boardWriter" class="detailinput" readonly>
    <textarea id="boardContent"class="detailinput" style="min-height: 500px;"></textarea>
    <input type="hidden" id="boardNum">
</div>
        <div class="buttonlist">
            <button id="readBtn" class="btn btn-primary">조회</button>
            <button id="modifyBtn" class="btn btn-success" onclick="updateBoard();">수정</button>
            <button id="deleteBtn" class="btn btn-danger" onclick="deleteBoard()">삭제</button>
        </div>
</div>
    <div class="writeView">
        <h2>새로 글쓰기</h2>
        <input type="text" id="writeBoardTitle" class="detailinput" style="font-weight: bolder">
            <input type="text" id="writeBoardWriter" class="detailinput">
            <textarea id="writeBoardContent"class="detailinput" style="min-height: 500px;"></textarea>
        <button id="registerBtn" class="btn btn-primary" style="width: 200px" onclick="registerNewBoard();">등록</button>
    </div>
</div>
</body>
</html>