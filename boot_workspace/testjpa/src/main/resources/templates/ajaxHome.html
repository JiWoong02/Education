<!DOCTYPE xmlns:th="http://www.thymeleaf.org">
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <style>
        div#listarea{
            float: left;
        }
        div#inputarea{
            width: 400px;
            height: 300px;
            border: 1px solid darkred;
            margin-left: 400px;
        }
    </style>
    <script type="text/javascript" src="/js/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function (){
            //board 테이블의 전체 목록 조회 출력
            $.ajax({
                url: "/boards",
                type: "GET",
                dataType: "json",
                success: function(data){
                    console.log("success : " + data);

                    //object --> string
                    var str = JSON.stringify(data);
                    //alert(str);
                    //string --> json
                    var json = JSON.parse(str);

                    values = "";
                    for(var i in json){
                        var detailId = 'read_'+json[i].boardNum;
                        values += "<tr><td>" + json[i].boardNum
                            + "</td><td><a id="+detailId+">"
                            + json[i].boardTitle
                            + "</a></td><td>"
                            + json[i].boardWriter + "</td></tr>";
                    }
                    $('#toplist').html($('#toplist').html() + values);
                },
                error: function(jqXHR, textStatus, errorThrown){
                    console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                }
            });  //ajax 목록조회
            // 등록 버튼 클릭하면, input 의 값들을 읽어와서, json 객체 만들어서 서버로 요청 보내기
            $('#registerBtn').on('click',function(){
                //값을 입력받은 input 태그에 접근
                var inputBtitle = $('#btitle');
                var inputBwriter = $('#bwriter');
                var inputBcontent = $('#bcontent');

                //각 input 태그에 기록된 값 추출
                var titleVal = inputBtitle.val();
                var writerVal = inputBwriter.val();
                var contentVal = inputBcontent.val();

                //전송할 json 객체 만들기
                var boardObject ={
                    boardTitle: titleVal,
                    boardWriter: writerVal,
                    boardContent: contentVal
                };

                $.ajax({
                    type : "POST",
                    url : "/boards",
                    data: JSON.stringify(boardObject),
                    contentType : "application/json; charset=UTF-8",
                    success : function (){
                        alert('Created');
                        window.location.reload(true); //빈괄호 또는 true // true가 서버에서 다시 읽어오기때문에 여기선 true
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                    }

                });   //글등록 ajax
            }); //click
            $('#readBtn').on('click',function(){
                var boardNumValue = $('#bnum').val();

                $.ajax({
                    type: "GET",
                    url: "/boards/"+boardNumValue,
                    contentType : "application/json; charset=UTF-8",
                    success:function(data){
                        $('#btitle').val(data.boardTitle);
                        $('#bwriter').val(data.boardWriter);
                        $('#bcontent').val(data.boardContent);
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                    }
                }); //글조회 ajax
            });//조회버튼 클릭
            $('#deleteBtn').on('click',function(){
                var boardNumValue = $('#bnum').val();

                $.ajax({
                    type:"DELETE",
                    url:"/boards/"+boardNumValue,
                    contentType : "application/json; charset=UTF-8",
                    success:function (){
                        alert('삭제성공!');
                        window.location.reload(true);
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                    }
                })
            });//삭제 버튼 클릭

            $('#modifyBtn').on('click',function (){
                var boardObject ={
                    boardNum: $('#bnum').val(),
                    boardTitle: $('#btitle').val(),
                    boardContent: $('#bcontent').val()
                };
                $.ajax({
                    type:"PUT",
                    url:"/boards/"+$('#bnum').val(), //PUT 전송시에는 반드시 url 뒤에 뭔가 하나 붙어야함
                    //pathvariable 에 대한 값이 없으면, 자동 post 로 전송이감
                    data: JSON.stringify(boardObject),
                    contentType : "application/json; charset=UTF-8",
                    success:function (){
                        alert('수정성공!!');
                        window.location.reload(true);
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                    }
                })
            });//수정버튼 클릭


        })// documentReady
    </script>
</head>
<body>
<div class="container">
    <h1>Spring Boot JPA Test : jpa only</h1>
    <hr>
    <h4>인기 게시글</h4>
    <div id="listarea">
        <table id="toplist">
            <tr><th>번호</th><th>제목</th><th>작성자</th></tr>
        </table>
    </div>
    <div id="inputarea">
        <table>
            <tr>
                <td><label for="bnum">번호</label></td>
                <td><input type="text" name="boardNum" id="bnum" value=""></td>
            </tr>
            <tr>
                <td><label for="btitle">제목</label></td>
                <td><input type="text" name="boardTitle" id="btitle" value=""></td>
            </tr>
            <tr>
                <td><label for="bwriter">작성자</label></td>
                <td><input type="text" name="boardWriter" id="bwriter" value=""></td>
            </tr>
            <tr>
                <td><label for="bcontent">내용</label></td>
                <td><textarea name="boardContent" id="bcontent" placeholder="내용을 입력해주세요" style="min-height: 100px;min-width: 200px"></textarea></td>
            </tr>
        </table>
        <hr>
        <div class="buttonlist">
            <button id="registerBtn" class="btn btn-primary">등록</button>
            <button id="readBtn" class="btn btn-primary">조회</button>
            <button id="modifyBtn" class="btn btn-success">수정</button>
            <button id="deleteBtn" class="btn btn-danger">삭제</button>
        </div>
        <div class="boardDetail">


        </div>
    </div>
</div>
</body>
</html>